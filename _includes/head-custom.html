<!-- Fallback if JS is disabled -->
<link rel="icon" href="/favicon.ico" sizes="any">

<!-- Dynamic pixel-art favicon: Tech Gold background, white A → L → I, slide-down transition -->
<script>
(function () {
  if (window.__favDyn) return;           // avoid double init if something re-includes head
  window.__favDyn = true;

  const GOLD = "#B3A369";                 // Georgia Tech Tech Gold
  const WHITE = "#FFFFFF";

  // 8×8 pixel letters, rendered 24×24 inside a 32×32 icon for padding (crisper look)
  const GRID = 8, SCALE = 3, SIZE = 32;
  const LETTER = GRID * SCALE;            // 24
  const OFFSET = ((SIZE - LETTER) / 2) | 0;

  // Letter maps ('1' = white pixel)
  const A = [
    "00111100",
    "01000010",
    "10000001",
    "11111111",
    "10000001",
    "10000001",
    "10000001",
    "10000001"
  ];
  const L = [
    "10000000",
    "10000000",
    "10000000",
    "10000000",
    "10000000",
    "10000000",
    "11111111",
    "00000000"
  ];
  const I = [
    "11111111",
    "00011000",
    "00011000",
    "00011000",
    "00011000",
    "00011000",
    "11111111",
    "00000000"
  ];
  const FRAMES = [A, L, I];

  const HOLD_MS  = 5000;                  // how long each letter stays
  const SLIDE_MS = 320;                   // slide duration

  // Ensure a single <link rel="icon"> that we control — remove all others now & later
  function ensureLink() {
    let link = document.querySelector('link#dynamic-favicon[rel="icon"]');
    if (!link) {
      link = document.createElement('link');
      link.id = 'dynamic-favicon';
      link.rel = 'icon';
      link.type = 'image/png';
      document.head.appendChild(link);
    }
    document.querySelectorAll('link[rel*="icon"]:not(#dynamic-favicon)').forEach(n => n.remove());
    return link;
  }
  const link = ensureLink();

  // If something adds icons later (rare, but can happen on some pages), remove them
  new MutationObserver(() => ensureLink()).observe(document.head, { childList: true });

  // Canvas render
  const c = document.createElement('canvas'); c.width = SIZE; c.height = SIZE;
  const ctx = c.getContext('2d', { alpha: true }); ctx.imageSmoothingEnabled = false;

  function draw(map, yOffset) {
    ctx.fillStyle = WHITE;
    for (let y = 0; y < GRID; y++) {
      const row = map[y];
      for (let x = 0; x < GRID; x++) if (row[x] === '1') {
        ctx.fillRect(OFFSET + x * SCALE, OFFSET + y * SCALE + yOffset, SCALE, SCALE);
      }
    }
  }

  function renderSlide(fromMap, toMap, t) {
    // Solid gold background each frame
    ctx.clearRect(0, 0, SIZE, SIZE);
    ctx.fillStyle = GOLD;
    ctx.fillRect(0, 0, SIZE, SIZE);

    // Slide down the old letter fully off; new letter slides in from top
    const DIST = LETTER + 6;              // a bit more than letter height
    const oldY = Math.round(DIST * t);
    const newY = oldY - DIST;

    draw(fromMap, oldY);
    draw(toMap, newY);

    link.href = c.toDataURL('image/png'); // dataURL busts cache
  }

  // Initial render + loop
  let idx = 0;
  renderSlide(FRAMES[0], FRAMES[1], 0);

  function cycle() {
    const from = FRAMES[idx];
    const to   = FRAMES[(idx + 1) % FRAMES.length];
    const start = performance.now();
    function step(now) {
      const t = Math.min(1, (now - start) / SLIDE_MS);
      renderSlide(from, to, t);
      if (t < 1) requestAnimationFrame(step);
      else { idx = (idx + 1) % FRAMES.length; setTimeout(cycle, HOLD_MS); }
    }
    requestAnimationFrame(step);
  }
  setTimeout(cycle, HOLD_MS);
})();
</script>
